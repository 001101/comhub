var humhub=humhub||function(a){var b={},c=[],d=!1,e=function(b,e){var h=g(b,!0);h.id="humhub.modules."+i(b),h.require=f,h["export"]=function(b){a.extend(h,b)},e(h,f,a),d?h.init():c.push(h)},f=function(a){var b=g(a);return b||console.warn("No module found for id: "+a),b},g=function(c,d){try{var e=i(c),f=b;return a.each(e.split("."),function(a,b){if(b in f)f=f[b];else{if(!d)return f=void 0,!1;f=f[b]={}}}),f}catch(g){return}},h={get:function(a,b,c){if(l(b)){var d=this.getModuleConfig(a)[b];return l(d)?d:c}},getModuleConfig:function(a){return this.module||(this.module={}),this.module},is:function(a,b,c){return this.get(a,b,c)===!0},set:function(b,c,d){2===arguments.length?a.extend(this.getModuleConfig(b),c):3===arguments.length&&(this.getModuleConfig(b)[c]=d)}},i=function(a){return j(j(a,"humhub."),"modules.")},j=function(a,b){return k(a,b)?a.substring(b.length,a.length):a},k=function(a,b){return a&&b?0===a.indexOf(b):!1},l=function(a){return"undefined"!=typeof a};return a(document).ready(function(){a.each(c,function(a,b){b.init&&b.init(),d=!0,console.log("Module initialized: "+b.id)})}),{initModule:e,modules:b,config:h}}($);humhub.initModule("util",function(a,b,c){var d={isFunction:function(a){return c.isFunction(a)},isObject:function(a){return c.isPlainObject(a)},isJQuery:function(a){return this.isDefined(a)&&a.jquery},isArray:function(a){return c.isArray(a)},isEmpty:function(a){return c.isEmptyObject(a)},isString:function(a){return"string"==typeof a},isNumber:function(a){return this.isDefined(a)&&!isNaN(parseFloat(a))&&isFinite(a)},isBoolean:function(a){return"boolean"==typeof a},isDefined:function(a){if(arguments.length>1){var b=!0,c=this;return this.each(arguments,function(a,b){return c.isDefined(b)?void 0:!1}),b}return"undefined"!=typeof a},inherits:function(a,b){a.prototype=Object.create(b.prototype),a._super=b.prototype}},e={cutprefix:function(a,b){return this.startsWith(a,b)?a.substring(b.length,a.length):a},cutsuffix:function(a,b){return a.slice(0,-1*b.length)},startsWith:function(a,b){return d.isDefined(a)&&d.isDefined(b)?0===a.indexOf(b):!1},endsWith:function(a,b){return d.isDefined(a)&&d.isDefined(b)?-1!==a.indexOf(b,a.length-b.length):!1}};a["export"]({object:d,string:e})}),humhub.initModule("additions",function(a,b,c){var d={};a.registerAddition=function(a,b){d[a]||(d[a]=[]),d[a].push(b)},a.applyTo=function(a){var b=c(a);c.each(d,function(a,d){c.each(d,function(d,e){c.each(b.find(a).addBack(a),function(){try{var d=c(this);e.apply(d,[d,b])}catch(f){console.error("Error while applying addition "+e+" on selector "+a)}})})})},a.init=function(){}}),humhub.initModule("client",function(a,b,c){var d=b("util").object,e=(b("scripts"),function(){}),f=function(a){this.data=a,c.extend(this,a)};f.prototype.isConfirmation=function(){return 0===this.getStatus()},f.prototype.isError=function(){return this.getStatus()>0||this.getErrors().length},f.prototype.getStatus=function(){return this.status?this.status:-1},f.prototype.getFirstError=function(){var a=this.getErrors();return a.length?a[0]:void 0},f.prototype.setAjaxError=function(a,b,c,d,e){this.xhr=a,this.textStatus=c,this.status=e||a.status,this.errors=[b]},f.prototype.getErrors=function(){var a=this.errors||[];return d.isString(a)?[a]:a},f.prototype.toString=function(){return"{ status: "+this.getStatus()+" error: "+this.getErrors()+" data: "+this.getContent()+" }"};var g=function(a,b){var b=b||{};a=d.isString(a)?c(a):a,b.type=a.attr("method")||"post",b.data=a.serialize(),i(a.attr("action"),b)},h=function(a,b){var b=b||{};return b.type="POST",i(a,b)},i=function(a,b){return new Promise(function(b,e){var g=g||{},h=g.async||!0,i=g.dataType||"json",j=function(a,b,c,h,i){if(g.error&&d.isFunction(g.error)){var j=new f;j.setAjaxError(a,c,b,h,i),g.error(j)}e(a,b,c,h,i)},k=function(a,c,d){var e=new f(a);return e.isError()?j(d,"application",e.getErrors(),a,e.getStatus()):(g.success&&(e.textStatus=c,e.xhr=d,g.success(e)),void b(e))};c.ajax({url:a,data:g.data,type:g.type,beforeSend:g.beforeSend,processData:g.processData,contentType:g.contentType,async:h,dataType:i,success:k,error:j})})};a["export"]({ajax:i,post:h,submit:g,init:e})}),humhub.initModule("ui",function(a,b,c){var d=b("additions");a.init=function(){d.registerAddition(".autosize",function(a){a.autosize()})}}),humhub.initModule("ui.modal",function(a,b,c){var d=b("util").object,e=b("additions"),f=[],g='<div class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none; background:rgba(0,0,0,0.1)"><div class="modal-dialog"><div class="modal-content"></div></div></div>',h='<div class="modal-header"><button type="button" class="close" data-modal-close="true" aria-hidden="true">Ã—</button><h4 class="modal-title"></h4></div>',i='<div class="modal-body"></div>',j="Error",k="An unknown error occured!",l=function(a){this.$modal=c("#"+a),this.$modal.lengh||this.createModal(a),this.initModal(),f.push(this)};l.prototype.createModal=function(a){this.$modal=c(g).attr("id",a),c("body").append(this.$modal)},l.prototype.initModal=function(){this.reset();var a=this;this.getDialog().on("click","[data-modal-close]",function(){a.close()}).on("click","[data-modal-clear-error]",function(){a.clearErrorMessage()}).on("click",function(a){a.stopPropagation()}),this.$modal.on("click",function(){a.close()})},l.prototype.close=function(){var a=this;this.$modal.fadeOut("fast",function(){a.getContent().html(""),a.reset()})},l.prototype.loader=function(){this.reset(),this.show()},l.prototype.reset=function(){this.content('<div class="modal-body"><div class="loader"><div class="sk-spinner sk-spinner-three-bounce"><div class="sk-bounce1"></div><div class="sk-bounce2"></div><div class="sk-bounce3"></div></div></div></div>'),this.isFilled=!1},l.prototype.content=function(a,b){try{var c=this;this.clearErrorMessage(),this.getContent().html(a).promise().always(function(){e.applyTo(c.getContent()),!b||b(this.$modal)}),this.isFilled=!0}catch(d){console.error("Error while setting modal content",d),this.setErrorMessage(d.message),e.applyTo(c.$modal)}},l.prototype.error=function(a,b){1===arguments.length&&a&&(b=a.getFirstError?a.getFirstError():a,a=a.getErrorTitle?a.getErrorTitle():j),a=a||j,b=b||k,this.isFilled?this.setErrorMessage(b):(this.clear(),this.setTitle(a),this.setBody(""),this.setErrorMessage(b),this.$modal.show())},l.prototype.clearErrorMessage=function(){var a=this.getErrorMessage();a.length&&a.fadeOut("fast",function(){a.remove()})},l.prototype.setErrorMessage=function(a){var b=this.getErrorMessage();b.length?(b.css("opacity",0),b.text(a),b.animate({opacity:1},"fast")):this.getBody().prepend('<div class="modal-error alert alert-danger">'+a+"</div>")},l.prototype.getErrorMessage=function(){return this.getContent().find(".modal-error")},l.prototype.show=function(){this.$modal.show()},l.prototype.clear=function(){this.getContent().empty()},l.prototype.getContent=function(){return this.$modal.find(".modal-content:first")},l.prototype.getDialog=function(){return this.$modal.find(".modal-dialog")},l.prototype.getForm=function(){return this.$modal.find("form")},l.prototype.setTitle=function(a){var b=this.getHeader();b.length||(this.getContent().prepend(c(h)),b=this.getHeader()),b.find(".modal-title").html(a)},l.prototype.setBody=function(a){var b=this.getBody();b.length||(this.getContent().append(c(i)),b=this.getBody()),b.html(a)},l.prototype.getHeader=function(){return this.$modal.find(".modal-header")},l.prototype.getBody=function(){return this.$modal.find(".modal-body")};var m=function(a,b){l.call(this,a),this.initButtons()};m.prototype.initButtons=function(a){this.$confirm=this.$modal.find("[data-modal-submit]"),this.$confirm.on("click",a)},d.inherits(m,l),a["export"]({init:function(){a.global=new l("global-modal")},Modal:l})}),humhub.initModule("actions",function(a,b,c){var d={},e=b("util").object,f=b("util").string,g=b("client");a.init=function(){this.bindAction(document,"click","[data-action-click]"),this.bindAction(document,"dblclick","[data-action-dblclick]"),this.bindAction(document,"change","[data-action-mouseout]"),b("additions").registerAddition("[data-action-load-button]",function(){var a=this;this.on("click.humhub-action-load-button",function(b){a.find(".action-loader").length||a.append('<span class="action-loader"><i class="fa fa-spinner fa-pulse"></i></span>')})})},a.registerHandler=function(a,b){a&&b&&(d[a]=b)},a.registerAjaxHandler=function(a,b,f,h){h=h||{},a&&(e.isFunction(b)?(h.success=b,h.error=f):h=b,b&&(d[a]=function(a){var b=c(this).data("url-"+a.type)||c(this).data("url");g.ajax(b,h,a)}))},a.bindAction=function(a,g,i,j){a=a||document;var k=a.jquery?a:c(a);k.on(g+".humhub-action",i,function(a){a.preventDefault(),$trigger=c(this);var i=$trigger.data("action-"+g),k={type:g,$trigger:$trigger,handler:i};k.finish=function(){h(a)};try{if(e.isFunction(j))j.apply($trigger,[k]);else if(d[i]){var l=d[i];l.apply($trigger,[k])}else if(!d["humhub.modules.content.actiontHandler"](k)){var m=i.split("."),l=m[m.length-1],n=b(f.cutsuffix(i,"."+l));n[l]({type:g,$trigger:$trigger})}}catch(o){console.error('Error while handling action event for handler "'+i+'"',o),h(a)}})};var h=function(a){a.target&&($target=c(a.target),$loader=$target.find(".action-loader"),$loader.length&&$loader.remove())}}),humhub.initModule("content",function(a,b,c){var d=b("client"),e=b("util").object,f=b("actions"),g=function(a){a&&(this.$=e.isString(a)?c("#"+a):a,this.contentBase=this.$.data("content-base"))};g.prototype.getContentActions=function(){return["create","edit","delete"]},g.prototype.getKey=function(){return this.$.data("content-pk")},g.prototype.data=function(a){var b=this.$.data(a);if(!b){var c=this.getParentContentBase();if(c)return c.data(a)}return b},g.prototype.getParentContentBase=function(){var a=this.$.parent().closest("[data-content-base]");if(a.length)try{var c=b(a.data("content-base"));return new c(a)}catch(d){console.error("Could not instantiate parent content base: "+a.data("content-base"))}},g.prototype.create=function(a){indexOf(this.getContentActions(),"create")<0||this.edit(a)},g.prototype.edit=function(a){if(!(indexOf(this.getContentActions(),"edit")<0)){var c=this.data("content-edit-url"),g=this.getKey(),h=b("ui.modal").global;if(!c)return void console.error("No editUrl found for edit content action editUrl: "+c+" contentId "+g);var i=this;d.ajax(c,{data:{id:g},beforeSend:function(){h.loader()},success:function(b){h.content(b.getContent(),function(){f.bindAction(h.getBody(),"click","[data-content-save]",function(b){d.submit(h.getForm(),{success:function(c){e.isFunction(a)?a(c,h)&&h.close():(i.replaceContent(c.getContent()),h.close()),b.finish()},error:function(a){h.error(a),console.error("Error while submitting form :"+a),b.finish()}})})})},error:function(a){h.error(a),console.log("Error occured while editing content: "+a.getFirstError())}})}},g.prototype["delete"]=function(){if(!(this.getContentActions().indexOf("delete")<0)){var a=this,b=this.data("content-delete-url");b?d.post(b,{data:{id:a.getKey()},success:function(b){b.success,a.remove()},error:function(a){console.error(a)}}):console.error("Content delete was called, but no url could be determined for "+this.contentBase)}},g.prototype.replaceContent=function(a){try{var b=this;this.$.animate({opacity:0},"fast",function(){b.$.html(c(a).children()),b.$.stop().animate({opacity:1},"fast"),b.highlight&&b.highlight()})}catch(d){console.error("Error occured while replacing content: "+this.$.attr("id"),d)}},g.prototype.remove=function(){var a=this;this.$.animate({height:"toggle",opacity:"toggle"},"fast",function(){a.$.remove()})},g.getContentBase=function(a){return a.closest("[data-content-base]")},g.getInstance=function(a){a=e.isString(a)?c("#"+a):a;var d=b(a.data("content-base"));return d?new d(a):void 0};var h=function(){f.registerHandler("humhub.modules.content.actiontHandler",function(b){return a.handleAction(b)})};handleAction=function(a){var b=g.getContentBase(a.$trigger);if(b.length){var c=g.getInstance(b);if(c){if(a.handler&&c[a.handler])return c[a.handler](a),!0}else console.error("No ContentType found for "+b.data("content-base"))}return!1},a["export"]({Content:g,init:h,handleAction:handleAction})}),humhub.initModule("stream",function(a,b,c){var d=b("util"),e=d.object,f=d.string,g=b("client"),h=(b("modal"),b("content").Content),i=8,j=4,k=function(a){this.$=e.isString(a)?this.$=c("#"+a):a,h.call(this)};e.inherits(k,h),k.prototype.getContentActions=function(){return["delete","edit"]},k.prototype["delete"]=function(){var a=this.getContentInstance();a&&a["delete"]?a["delete"]():k._super["delete"].call(this)},k.prototype.reload=function(){m().reload(this)},k.prototype.edit=function(){},k.prototype.getContentInstance=function(){return h.getInstance(this.$.find("[data-content-base]"))};var l=function(a){return this.$=e.isString(a)?c("#"+a):a,this.$.length?(this.$.data("stream-contentid")&&(this.contentId=parseInt(this.$.data("stream-contentid"))),this.$stream=this.$.find(".s2_stream"),this.url=this.$.data("stream"),this.$loader=this.$stream.find(".streamLoader"),this.$content=this.$stream.find(".s2_streamContent"),this.$filter=c(".wallFilterPanel"),this.filters=[],this.sort="c",void h.call(this)):void console.error("Could not initialize stream, invalid container given"+a)};e.inherits(l,h),l.prototype.getContentActions=function(){return[]},l.prototype.init=function(){return this.clear(),this.$stream.show(),this.isShowSingleEntry()?this.loadSingleEntry(this.contentId):this.loadEntries(i),this},l.prototype.clear=function(){this.lastEntryLoaded=!1,this.readOnly=!1,this.loading=!1,this.$.find(".s2_streamContent").empty(),this.$.find(".s2_stream").hide(),this.$.find(".s2_single").hide(),this.$.find(".streamLoader").hide(),this.$.find(".emptyStreamMessage").hide(),this.$.find(".emptyFilterStreamMessage").hide(),this.$.find(".back_button_holder").hide(),this.$filter.hide()},l.prototype.loadSingleEntry=function(a){this.$.find(".back_button_holder").show(),this.loadEntries(1,a+1,"")},l.prototype.reloadEntry=function(a){var b=this;return new Promise(function(c,d){if(a=a instanceof k?a:b.getEntry(a),!a)return console.warn("Attempt to reload of non existent entry: "+a),void d();var e=a.getKey();return b._load(1,e+1,"").then(function(b){b.content[e]?(a.replaceContent(b.content[e].output),c(a)):(console.warn("Reload failed: ContentId not found in response: "+e),d())},d)})},l.prototype.loadEntries=function(a,b,d,f){if(!this.loading&&!this.lastEntryLoaded){this.$loader.show(),this.loading=!0,a=a||j,b=b||this.getLastContentId(),d=d||this.getFilterString(),f=f||this.sort;var g=this;return new Promise(function(h,i){g._load(a,b,d,f).then(function(a){g.$loader.hide(),e.isEmpty(a.content)?(g.lastEntryLoaded=!0,c("#btn-load-more").hide()):(g.lastEntryLoaded=a.is_last,g.appendEntries(a)),g.loading=!1,g.onChange(),h()})["catch"](function(a){g.loading=!1,g.$loader.hide(),i()})})}},l.prototype._load=function(a,b,c,d){return g.ajax(this.url,{data:{filters:c,sort:d,from:b,limit:a}})},l.prototype.getLastContentId=function(){var a=this.$stream.find("[data-content-pk]").last();return a.length?a.data("stream-contentid"):void 0},l.prototype.appendEntries=function(a){var b=this,d="";return c.each(a.contentIds,function(c,e){var f=b.$.find('[data-content-pk="'+e+'"]');f.length&&f.remove(),d+=a.content[e].output}),this.$content.append(d)},l.prototype.onChange=function(){this.readOnly?(c(".wallReadOnlyHide").hide(),c(".wallReadOnlyShow").show()):c(".wallReadOnlyShow").hide();var a=this.hasEntries();a||this.hasFilter()?a?this.isShowSingleEntry()||(this.$filter.show(),this.$.find(".emptyStreamMessage").hide(),this.$.find(".emptyFilterStreamMessage").hide()):this.$.find(".emptyFilterStreamMessage").hide():(this.$.find(".emptyStreamMessage").show(),this.$filter.hide())},l.prototype.isShowSingleEntry=function(){return e.isDefined(this.contentId)},l.prototype.hasEntries=function(){return this.getEntryCount()>0},l.prototype.getEntryCount=function(){return this.$.find("[data-content-pk]").length},l.prototype.hasFilter=function(){return this.filters.length>0},l.prototype.getFilterString=function(){var a="";return c.each(this.filters,function(b,c){a+=c+","}),f.cutsuffix(a,",")},l.prototype.setFilter=function(a){this.filters.indexOf(a)<0&&this.filters.push(a)},l.prototype.unsetFilter=function(a){var b=this.filters.indexOf(a);b>-1&&this.filters.splice(b,1)},l.prototype.getEntry=function(a){return new k(this.$.find('[data-content-pk="'+a+'"]'))},l.prototype.getEntryByNode=function(a){return new k(a.closest("[data-content-pk]"))};var m=function(){return a.instance||(a.instance=new l(c("[data-stream]"))),a.instance},n=function(b){return a.getStream().getEntry(b)},o=function(){var a=m().init();c(window).scroll(function(){c(window).scrollTop()==c(document).height()-c(window).height()&&(!a||a.loading||a.isShowSingleEntry()||a.lastEntryLoaded||a.loadEntries())}),a.$.on("click",".singleBackLink",function(){a.contentId=void 0,a.init(),c(this).hide()}),p()},p=function(){c(".wallFilter").click(function(){var a=c(this),b=a.children("i");b.toggleClass("fa-square-o").toggleClass("fa-check-square-o"),b.hasClass("fa-check-square-o")?m().setFilter(a.attr("id").replace("filter_","")):m().unsetFilter(a.attr("id").replace("filter_","")),m().init()}),c(".wallSorting").click(function(){var a=c(this).attr("id");c(".wallSorting").find("i").removeClass("fa-check-square-o").addClass("fa-square-o"),c("#"+a).children("i").removeClass("fa-square-o").addClass("fa-check-square-o"),a=a.replace("sorting_",""),m().sort=a,m().init()})};a["export"]({StreamEntry:k,Stream:l,getStream:m,getEntry:n,init:o})});