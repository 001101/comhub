var humhub=humhub||function(a){var b={},c=[],d=!1,e=function(b,e){var i=g(b,!0);i.id="humhub.modules."+h(b),i.require=f,i["export"]=function(b){a.extend(i,b)},e(i,f,a),d?i.init():c.push(i)},f=function(a){var b=g(a);return b||console.warn("No module found for id: "+a),b},g=function(c,d){try{var e=h(c),f=b;return a.each(e.split("."),function(a,b){if(b in f)f=f[b];else{if(!d)return f=void 0,!1;f=f[b]={}}}),f}catch(g){return}},h=function(a){return i(i(a,"humhub."),"modules.")},i=function(a,b){return j(a,b)?a.substring(b.length,a.length):a},j=function(a,b){return a&&b?0===a.indexOf(b):!1};return a(document).ready(function(){a.each(c,function(a,b){b.init&&b.init(),d=!0,console.log("Module initialized: "+b.id)})}),{initModule:e}}($);humhub.initModule("util",function(a,b,c){var d={isFunction:function(a){return c.isFunction(a)},isObject:function(a){return c.isPlainObject(a)},isJQuery:function(a){return this.isDefined(a)&&a.jquery},isArray:function(a){return c.isArray(a)},isString:function(a){return"string"==typeof a},isNumber:function(a){return this.isDefined(a)&&!isNaN(parseFloat(a))&&isFinite(a)},isBoolean:function(a){return"boolean"==typeof a},isDefined:function(a){if(arguments.length>1){var b=!0,c=this;return this.each(arguments,function(a,b){return c.isDefined(b)?void 0:!1}),b}return"undefined"!=typeof a},inherits:function(a,b){a.prototype=Object.create(b.prototype),a._super=b.prototype}},e={cutprefix:function(a,b){return this.startsWith(b)?a.substring(b.length,a.length):a},cutsuffix:function(a,b){return a.slice(0,-1*b.length)},startsWith:function(a,b){return d.isDefined(a)&&d.isDefined(b)?0===a.indexOf(b):!1},endsWith:function(a,b){return d.isDefined(a)&&d.isDefined(b)?-1!==a.indexOf(b,a.length-b.length):!1}};a["export"]({object:d,string:e})}),humhub.initModule("additions",function(a,b,c){var d={};a.registerAddition=function(a,b){d[a]||(d[a]=[]),d[a].push(b)},a.applyTo=function(a){var b=c(a);c.each(d,function(a,d){c.each(d,function(d,e){c.each(b.find(a).addBack(a),function(){try{var d=c(this);e.apply(d,[d,b])}catch(f){console.error("Error while applying addition "+e+" on selector "+a)}})})})},a.init=function(){}}),humhub.initModule("client",function(a,b,c){var d=b("util").object,e=(b("scripts"),function(){}),f=function(a){this.data=a};f.prototype.isConfirmation=function(){return 0===this.getStatus()},f.prototype.isError=function(){return this.getStatus()>0||this.getErrors().length},f.prototype.getStatus=function(){return this.data&&d.isDefined(this.data.status)?this.data.status:-1},f.prototype.getErrorTitle=function(){return this.data?this.data.errorTitle:void 0},f.prototype.getFirstError=function(){var a=this.getErrors();return a.length?a[0]:void 0},f.prototype.setAjaxError=function(a,b,c,d,e){this.xhr=a,this.textStatus=c,this.data=d||{},this.data.status=e||a.status,this.data.errors=[b]},f.prototype.getErrors=function(){if(this.data){var a=this.data.errors||[];return d.isString(a)?[a]:a}return[]},f.prototype.getContent=function(){return this.data.content},f.prototype.getPartial=function(a){return this.data?d.isObject(this.data.content)?a?this.data.content[a]:this.data.content:a?void 0:this.data.content:void 0},f.prototype.toString=function(){return"{ status: "+this.getStatus()+" error: "+this.getErrors()+" data: "+this.getContent()+" }"};var g=function(a,b){var b=b||{};a=d.isString(a)?c(a):a,b.type=a.attr("method")||"post",b.data=a.serialize(),h(a.attr("action"),b)},h=function(a,b){var b=b||{},e=b.async||!0,g=b.dataType||"json",h=function(c,e,g,h,i){if(b.error&&d.isFunction(b.error)){var j=new f;j.setAjaxError(c,g,e,h,i),b.error(j)}else console.warn("Unhandled ajax error: "+a+" type"+type+" error: "+g)},i=function(a,c,d){var e=new f(a);return e.isError()?h(d,"application",e.getErrors(),a,e.getStatus()):void(b.success&&(e.textStatus=c,e.xhr=d,b.success(e)))};c.ajax({url:a,data:b.data,type:b.type,beforeSend:b.beforeSend,processData:b.processData,contentType:b.contentType,async:e,dataType:g,success:i,error:h})};a["export"]({ajax:h,submit:g,init:e})}),humhub.initModule("ui",function(a,b,c){var d=b("additions");a.init=function(){d.registerAddition(".autosize",function(a){a.autosize()})}}),humhub.initModule("actions",function(a,b,c){var d={},e=b("util").object,f=b("util").string,g=b("client");a.init=function(){this.bindAction(document,"click","[data-action-click]"),this.bindAction(document,"dblclick","[data-action-dblclick]"),this.bindAction(document,"change","[data-action-mouseout]"),b("additions").registerAddition("[data-action-load-button]",function(){var a=this;this.on("click.humhub-action-load-button",function(b){a.find(".action-loader").length||a.append('<span class="action-loader"><i class="fa fa-spinner fa-pulse"></i></span>')})})},a.registerHandler=function(a,b){a&&b&&(d[a]=b)},a.registerAjaxHandler=function(a,b,f,h){h=h||{},a&&(e.isFunction(b)?(h.success=b,h.error=f):h=b,b&&(d[a]=function(a){var b=c(this).data("url-"+a.type)||c(this).data("url");g.ajax(b,h,a)}))},a.bindAction=function(a,g,i,j){a=a||document;var k=a.jquery?a:c(a);k.on(g+".humhub-action",i,function(a){a.preventDefault(),$trigger=c(this);var i=$trigger.data("action-"+g),k={type:g,$trigger:$trigger,handler:i};k.finish=function(){h(a)};try{if(e.isFunction(j))j.apply($trigger,[k]);else if(d[i]){var l=d[i];l.apply($trigger,[k])}else if(!d["humhub.modules.content.actiontHandler"](k)){var m=i.split("."),l=m[m.length-1],n=b(f.cutsuffix(i,"."+l));n[l]({type:g,$trigger:$trigger})}}catch(o){console.error('Error while handling action event for handler "'+i+'"',o),h(a)}})};var h=function(a){a.target&&($target=c(a.target),$loader=$target.find(".action-loader"),$loader.length&&$loader.remove())}}),humhub.initModule("content",function(a,b,c){var d=b("client"),e=b("util").object,f=b("actions");a.init=function(){f.registerHandler("humhub.modules.content.actiontHandler",function(b){return a.handleAction(b)})},a.handleAction=function(a){var c=this.getContentBase(a.$trigger);if(c.length){var d=b(c.data("content-base"));if(d){var e=new d(c);if(a.handler&&e[a.handler])return e[a.handler](a),!0}else console.error("No ContentType found for "+c.data("content-base"))}return!1},a.getContentBase=function(a){return a.closest("[data-content-base]")};var g=function(a){a&&("string"==typeof a?(this.id=a,this.$=c("#"+a)):a.jquery&&(this.$=a,this.id=this.$.attr("id")))};g.prototype.getKey=function(){return this.$.data("content-key")},g.prototype.getEditUrl=function(){var a=this.$.data("content-edit-url");if(!a){var b=this.getParentContentBase("[data-content-base]");if(b)return b.getEditUrl()}return a},g.prototype.getParentContentBase=function(){var a=this.$.parent().closest("[data-content-base]");if(a.length)try{var c=b(a.data("content-base"));return new c(a)}catch(d){console.error("Could not instantiate parent content base: "+a.data("content-base"))}},g.prototype.create=function(a){this.edit(a)},g.prototype.edit=function(a){var c=this.getEditUrl(),g=this.getKey(),h=b("ui.modal").global;if(!c)return void console.error("No editUrl found for edit content action editUrl: "+c+" contentId "+g);var i=this;d.ajax(c,{data:{id:g},beforeSend:function(){h.loader()},success:function(b){h.content(b.getContent(),function(){f.bindAction(h.getBody(),"click","[data-content-save]",function(b){d.submit(h.getForm(),{success:function(c){e.isFunction(a)?a(c,h)&&h.close():(i.replaceContent(c.getContent()),h.close()),b.finish()},error:function(a){h.error(a),console.error("Error while submitting form :"+a),b.finish()}})})})},error:function(a){h.error(a),console.log("Error occured while editing content: "+a.getFirstError())}})},g.prototype.replaceContent=function(a){try{this.$.html(c(a).children())}catch(b){console.error("Error occured while replacing content: "+this.id,b)}},g.prototype["delete"]=function(){},a.Content=g}),humhub.initModule("stream",function(a,b,c){var d="#wallEntry_",e="wallStream",f=function(a){"string"==typeof a?(this.id=a,this.$=c("#"+a)):a.jquery&&(this.$=a,this.id=this.$.attr("id"))};f.prototype.remove=function(){this.$.remove()},f.prototype.getContentKey=function(){},f.prototype.edit=function(){},f.prototype["delete"]=function(){},f.prototype.getContent=function(){return this.$.find(".content")};var g=function(a){this.id=a,this.$=c("#"+a)};g.prototype.getEntry=function(b){return new a.Entry(this.$.find(d+b))},g.prototype.wallStick=function(a){c.ajax({dataType:"json",type:"post",url:a}).done(function(a){a.success?currentStream&&(c.each(a.wallEntryIds,function(a,b){currentStream.deleteEntry(b),currentStream.prependEntry(b)}),c("html, body").animate({scrollTop:0},"slow")):alert(a.errorMessage)})},g.prototype.wallUnstick=function(a){c.ajax({dataType:"json",type:"post",url:a}).done(function(a){a.success&&currentStream.showStream()})},g.prototype.wallArchive=function(a){url=wallArchiveLinkUrl.replace("-id-",a),c.ajax({dataType:"json",type:"post",url:url}).done(function(a){a.success&&currentStream&&c.each(a.wallEntryIds,function(a,b){function d(){c("#wallEntry_"+b).fadeOut("slow")}setInterval(d(),1e3)})})},g.prototype.wallUnarchive=function(a){url=wallUnarchiveLinkUrl.replace("-id-",a),c.ajax({dataType:"json",type:"post",url:url}).done(function(a){a.success&&currentStream&&c.each(a.wallEntryIds,function(a,b){currentStream.reloadWallEntry(b)})})};var h=function(){return a.mainStream||(a.mainStream=new a.Stream(e)),a.mainStream},i=function(b){return a.getStream().getEntry(b)};a["export"]({getStream:h,getEntry:i})}),humhub.initModule("ui.modal",function(a,b,c){var d=b("additions"),e=(b("actions"),[]),f='<div class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none; background:rgba(0,0,0,0.1)"><div class="modal-dialog"><div class="modal-content"></div></div></div>',g='<div class="modal-header"><button type="button" class="close" data-modal-close="true" aria-hidden="true">Ã—</button><h4 class="modal-title"></h4></div>',h='<div class="modal-body"></div>',i="Error",j="An unknown error occured!",k=function(a){this.$modal=c("#"+a),this.$modal.lengh||this.createModal(a),this.initModal(),e.push(this)};k.prototype.createModal=function(a){this.$modal=c(f).attr("id",a),c("body").append(this.$modal)},k.prototype.initModal=function(){this.reset();var a=this;this.getDialog().on("click","[data-modal-close]",function(){a.close()}).on("click","[data-modal-clear-error]",function(){a.clearErrorMessage()}).on("click",function(a){a.stopPropagation()}),this.$modal.on("click",function(){a.close()})},k.prototype.close=function(){var a=this;this.$modal.fadeOut("fast",function(){a.getContent().html(""),a.reset()})},k.prototype.loader=function(){this.reset(),this.show()},k.prototype.reset=function(){this.content('<div class="modal-body"><div class="loader"><div class="sk-spinner sk-spinner-three-bounce"><div class="sk-bounce1"></div><div class="sk-bounce2"></div><div class="sk-bounce3"></div></div></div></div>'),this.isFilled=!1},k.prototype.content=function(a,b){try{var c=this;this.clearErrorMessage(),this.getContent().html(a).promise().always(function(){d.applyTo(c.getContent()),!b||b(this.$modal)}),this.isFilled=!0}catch(e){console.error("Error while setting modal content",e),this.setErrorMessage(e.message),d.applyTo(c.$modal)}},k.prototype.error=function(a,b){1===arguments.length&&a&&(b=a.getFirstError?a.getFirstError():a,a=a.getErrorTitle?a.getErrorTitle():i),a=a||i,b=b||j,this.isFilled?this.setErrorMessage(b):(this.clear(),this.setTitle(a),this.setBody(""),this.setErrorMessage(b),this.$modal.show())},k.prototype.clearErrorMessage=function(){var a=this.getErrorMessage();a.length&&a.fadeOut("fast",function(){a.remove()})},k.prototype.setErrorMessage=function(a){var b=this.getErrorMessage();b.length?(b.css("opacity",0),b.text(a),b.animate({opacity:1},"fast")):this.getBody().prepend('<div class="modal-error alert alert-danger">'+a+"</div>")},k.prototype.getErrorMessage=function(){return this.getContent().find(".modal-error")},k.prototype.show=function(){this.$modal.show()},k.prototype.clear=function(){this.getContent().empty()},k.prototype.getContent=function(){return this.$modal.find(".modal-content:first")},k.prototype.getDialog=function(){return this.$modal.find(".modal-dialog")},k.prototype.getForm=function(){return this.$modal.find("form")},k.prototype.setTitle=function(a){var b=this.getHeader();b.length||(this.getContent().prepend(c(g)),b=this.getHeader()),b.find(".modal-title").html(a)},k.prototype.setBody=function(a){var b=this.getBody();b.length||(this.getContent().append(c(h)),b=this.getBody()),b.html(a)},k.prototype.getHeader=function(){return this.$modal.find(".modal-header")},k.prototype.getBody=function(){return this.$modal.find(".modal-body")},a["export"]({init:function(){a.global=new k("global-modal")},Modal:k})});