var humhub=humhub||function(a){var b={},c=[],d=!1,e=function(b,e){var h=g(b,!0);h.id="humhub.modules."+i(b),h.require=f,h["export"]=function(b){a.extend(h,b)};try{e(h,f,a)}catch(j){console.error("Error while creating module: "+b,j)}d?h.init():c.push(h)},f=function(a){var b=g(a);return b||console.warn("No module found for id: "+a),b},g=function(c,d){try{var e=i(c),f=b;return a.each(e.split("."),function(a,b){if(b in f)f=f[b];else{if(!d)return f=void 0,!1;f=f[b]={}}}),f}catch(g){return}},h={get:function(a,b,c){if(1===arguments.length)return this.getModuleConfig(a);if(l(b)){var d=this.getModuleConfig(a)[b];return l(d)?d:c}},getModuleConfig:function(a){return this[a]||(this[a]={}),this[a]},is:function(a,b,c){return this.get(a,b,c)===!0},set:function(b,c,d){if(1===arguments.length){var e=this;a.each(b,function(a,b){e.set(a,b)})}else 2===arguments.length?a.extend(this.getModuleConfig(b),c):3===arguments.length&&(this.getModuleConfig(b)[c]=d)}},i=function(a){return j(j(a,"humhub."),"modules.")},j=function(a,b){return k(a,b)?a.substring(b.length,a.length):a},k=function(a,b){return a&&b?0===a.indexOf(b):!1},l=function(a){return"undefined"!=typeof a};return a(document).ready(function(){a.each(c,function(a,b){if(b.init)try{b.init()}catch(c){console.error("Could not initialize module: "+b.id,c)}d=!0,console.log("Module initialized: "+b.id)})}),{initModule:e,modules:b,config:h}}($);humhub.initModule("util",function(a,b,c){var d={isFunction:function(a){return c.isFunction(a)},isObject:function(a){return c.isPlainObject(a)},isJQuery:function(a){return this.isDefined(a)&&a.jquery},isArray:function(a){return c.isArray(a)},isEmpty:function(a){return c.isEmptyObject(a)},isString:function(a){return"string"==typeof a},isNumber:function(a){return this.isDefined(a)&&!isNaN(parseFloat(a))&&isFinite(a)},isBoolean:function(a){return"boolean"==typeof a},isDefined:function(a){if(arguments.length>1){var b=!0,c=this;return this.each(arguments,function(a,b){return c.isDefined(b)?void 0:!1}),b}return"undefined"!=typeof a},inherits:function(a,b){a.prototype=Object.create(b.prototype),a._super=b.prototype}},e={cutprefix:function(a,b){return this.startsWith(a,b)?a.substring(b.length,a.length):a},cutsuffix:function(a,b){return a.slice(0,-1*b.length)},startsWith:function(a,b){return d.isDefined(a)&&d.isDefined(b)?0===a.indexOf(b):!1},endsWith:function(a,b){return d.isDefined(a)&&d.isDefined(b)?-1!==a.indexOf(b,a.length-b.length):!1}};a["export"]({object:d,string:e})}),humhub.initModule("additions",function(a,b,c){var d={};a.registerAddition=function(a,b){d[a]||(d[a]=[]),d[a].push(b)},a.applyTo=function(a){var b=c(a);c.each(d,function(a,d){c.each(d,function(d,e){c.each(b.find(a).addBack(a),function(){try{var d=c(this);e.apply(d,[d,b])}catch(f){console.error("Error while applying addition "+e+" on selector "+a)}})})})},a.init=function(){}}),humhub.initModule("client",function(a,b,c){var d=b("util").object,e=function(){},f=function(a){c.extend(this,a)};f.prototype.isConfirmation=function(){return 0===this.getStatus()},f.prototype.isError=function(){return this.getStatus()>0||this.getErrors().length},f.prototype.getStatus=function(){return this.status?this.status:-1},f.prototype.getFirstError=function(){var a=this.getErrors();return a.length?a[0]:void 0},f.prototype.setAjaxError=function(a,b,c,d,e){this.xhr=a,this.textStatus=c,this.status=e||a.status,this.errors=[b]},f.prototype.getErrors=function(){var a=this.errors||[];return d.isString(a)?[a]:a},f.prototype.toString=function(){return"{ status: "+this.getStatus()+" error: "+this.getErrors()+" data: "+this.getContent()+" }"};var g=function(a,b){var b=b||{};a=d.isString(a)?c(a):a,b.type=a.attr("method")||"post",b.data=a.serialize(),i(a.attr("action"),b)},h=function(a,b){var b=b||{};return b.type="POST",b.method="POST",i(a,b)},i=function(a,b){return new Promise(function(e,g){b=b||{};var h=b.error,i=function(a,b,c,e,i){if(h&&d.isFunction(h)){var j=new f;j.setAjaxError(a,c,b,e,i),h(j)}g(a,b,c,e,i)},j=b.success,k=function(a,b,c){var d=new f(a);return d.isError()?i(c,"application",d.getErrors(),a,d.getStatus()):(j&&(d.textStatus=b,d.xhr=c,j(d)),void e(d))};b.success=k,b.error=i,b.url=a,b.dataType=b.dataType||"json",c.ajax(b)})};a["export"]({ajax:i,post:h,submit:g,init:e})}),humhub.initModule("ui",function(a,b,c){var d=b("additions");a.init=function(){d.registerAddition(".autosize",function(a){a.autosize()})}}),humhub.initModule("ui.modal",function(a,b,c){var d=b("util").object,e=b("additions"),f=humhub.config.getModuleConfig("ui.modal"),g=[],h='<div class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none; background:rgba(0,0,0,0.1)"><div class="modal-dialog"><div class="modal-content"></div></div></div>',i='<div class="modal-header"><button type="button" class="close" data-modal-close="true" aria-hidden="true">Ã—</button><h4 class="modal-title"></h4></div>',j='<div class="modal-body"></div>',k="Error",l="An unknown error occured!",m=function(a){this.$modal=c("#"+a),this.$modal.length||this.createModal(a),this.initModal(),g.push(this)};m.prototype.createModal=function(a){this.$modal=c(h).attr("id",a),c("body").append(this.$modal)},m.prototype.initModal=function(){this.reset();var a=this;this.getDialog().on("click","[data-modal-close]",function(){a.close()}).on("click","[data-modal-clear-error]",function(){a.clearErrorMessage()})},m.prototype.close=function(){var a=this;this.$modal.fadeOut("fast",function(){a.$modal.modal("hide"),a.reset()})},m.prototype.loader=function(){this.reset(),this.show()},m.prototype.reset=function(){this.setBody('<div class="loader"><div class="sk-spinner sk-spinner-three-bounce"><div class="sk-bounce1"></div><div class="sk-bounce2"></div><div class="sk-bounce3"></div></div></div>'),this.isFilled=!1},m.prototype.content=function(a,b){try{var c=this;this.clearErrorMessage(),this.getContent().html(a).promise().always(function(){e.applyTo(c.getContent()),!b||b(this.$modal)}),this.isFilled=!0}catch(d){console.error("Error while setting modal content",d),this.setErrorMessage(d.message),e.applyTo(c.$modal)}},m.prototype.error=function(a,b){1===arguments.length&&a&&(b=a.getFirstError?a.getFirstError():a,a=a.getErrorTitle?a.getErrorTitle():k),a=a||k,b=b||l,this.isFilled?this.setErrorMessage(b):(this.clear(),this.setTitle(a),this.setBody(""),this.setErrorMessage(b),this.show())},m.prototype.clearErrorMessage=function(){var a=this.getErrorMessage();a.length&&a.fadeOut("fast",function(){a.remove()})},m.prototype.setErrorMessage=function(a){var b=this.getErrorMessage();b.length?(b.css("opacity",0),b.text(a),b.animate({opacity:1},"fast")):this.getBody().prepend('<div class="modal-error alert alert-danger">'+a+"</div>")},m.prototype.getErrorMessage=function(){return this.getContent().find(".modal-error")},m.prototype.show=function(){this.$modal.modal("show")},m.prototype.clear=function(){this.getContent().empty()},m.prototype.getContent=function(){return this.$modal.find(".modal-content:first")},m.prototype.getDialog=function(){return this.$modal.find(".modal-dialog")},m.prototype.getForm=function(){return this.$modal.find("form")},m.prototype.setTitle=function(a){var b=this.getHeader();b.length||(this.getContent().prepend(c(i)),b=this.getHeader()),b.find(".modal-title").html(a)},m.prototype.setBody=function(a){var b=this.getBody();b.length||(this.getContent().append(c(j)),b=this.getBody()),b.html(a)},m.prototype.getHeader=function(){return this.$modal.find(".modal-header")},m.prototype.getBody=function(){return this.$modal.find(".modal-body")};var n=function(a,b){m.call(this,a)};d.inherits(n,m),n.prototype.open=function(a){this.clear(),a.header=a.header||f.defaultConfirmHeader,a.body=a.body||f.defaultConfirmBody,a.confirmText=a.confirmText||f.defaultConfirmText,a.cancleText=a.cancleText||f.defaultCancelText,this.setTitle(a.header),this.setBody(a.body),this.initButtons(a),this.show()},n.prototype.clear=function(a){this.$modal.find("[data-modal-confirm]").off("click"),this.$modal.find("[data-modal-cancel]").off("click")},n.prototype.initButtons=function(a){var b=this.$modal.find("[data-modal-cancel]");b.text(a.cancleText);var c=this.$modal.find("[data-modal-confirm]");c.text(a.confirmText);var d=this;a.confirm&&c.one("click",function(b){d.clear(),a.confirm(b)}),a.cancel&&b.one("click",function(b){d.clear(),a.cancel(b)})},a["export"]({init:function(){a.global=new m("globalModal"),a.globalConfirm=new n("globalModalConfirm"),a.confirm=function(b){a.globalConfirm.open(b)}},Modal:m})}),humhub.initModule("actions",function(a,b,c){var d={},e=b("util").object,f=b("util").string,g=b("client"),h="action-component",i="[data-"+h+"]",j=function(a){a&&(this.$=e.isString(a)?c("#"+a):a,this.base=this.$.data(h))};j.prototype.data=function(a){var b=this.$.data(a);if(!b){var c=this.parent();if(c)return c.data(a)}return b},j.prototype.parent=function(){var a=this.$.parent().closest(i);if(a.length)try{var c=b(a.data(h));return new c(a)}catch(d){console.error("Could not instantiate parent component: "+a.data(h))}},j.prototype.children=function(){var a=[];return this.$.find(i).each(function(){var b=j.getInstance(c(this));b&&a.push(b)}),a},j.prototype.hasAction=function(a){return this.actions().indexOf(a)>=0},j.prototype.actions=function(){return[]},j.getInstance=function(a){a=e.isString(a)?c("#"+a):a;var d=a.data(h)?a:j.getClosestComponentNode(a),f=d.data(h),g=b(f);return g?new g(d):void console.error("Tried to instantiate component with invalid type: "+f)},j.getClosestComponentNode=function(a){return a.closest(i)},j.handleAction=function(a){var b=j.getInstance(a.$trigger);return b&&a.handler&&b[a.handler]?(b[a.handler](a),!0):!1},a.init=function(){this.bindAction(document,"click","[data-action-click]"),this.bindAction(document,"dblclick","[data-action-dblclick]"),this.bindAction(document,"change","[data-action-mouseout]"),b("additions").registerAddition("[data-action-load-button]",function(){var a=this;this.on("click.humhub-action-load-button",function(b){a.find(".action-loader").length||a.append('<span class="action-loader"><i class="fa fa-spinner fa-pulse"></i></span>')})})},a.registerHandler=function(a,b){a&&b&&(d[a]=b)},a.registerAjaxHandler=function(a,b,f,h){h=h||{},a&&(e.isFunction(b)?(h.success=b,h.error=f):h=b,b&&(d[a]=function(a){var b=c(this).data("action-url-"+a.type)||c(this).data("action-url");g.ajax(b,h)}))},a.bindAction=function(a,g,h,i){a=a||document;var l=a.jquery?a:c(a);l.on(g+".humhub-action",h,function(a){a.preventDefault(),$trigger=c(this);var h=$trigger.data("action-"+g),l={type:g,$trigger:$trigger,handler:h};l.finish=function(){k(a)};try{if(e.isFunction(i))return void i.apply($trigger,[l]);if(j.handleAction(l))return;if(d[h]){var m=d[h];return void m.apply($trigger,[l])}var n=h.split("."),m=n[n.length-1],o=b(f.cutsuffix(h,"."+m));e.isFunction(o)?o[m]({type:g,$trigger:$trigger}):console.error("Could not determine actionhandler for: "+h)}catch(p){console.error('Error while handling action event for handler "'+h+'"',p),k(a)}})};var k=function(a){a.target&&($target=c(a.target),$loader=$target.find(".action-loader"),$loader.length&&$loader.remove())};a["export"]({Component:j})}),humhub.initModule("content",function(a,b,c){var d=b("client"),e=b("util").object,f=b("actions"),g=f.Component,h="content-key",i="content-edit-url",j="[data-content-save]",k="content-delete-url",l=function(a){g.call(this,a)};e.inherits(l,g),l.prototype.actions=function(){return["create","edit","delete"]},l.prototype.getKey=function(){return this.$.data(h)},l.prototype.create=function(a){this.hasAction("create")||this.edit(a)},l.prototype.edit=function(a){if(this.hasAction("edit")){var c=this.data(i),g=this.getKey(),h=b("ui.modal").global;if(!c)return void console.error("No editUrl found for edit content action editUrl: "+c+" contentId "+g);var k=this;d.ajax(c,{data:{id:g},beforeSend:function(){h.loader()},success:function(b){h.content(b.getContent(),function(){f.bindAction(h.getBody(),"click",j,function(b){d.submit(h.getForm(),{success:function(c){e.isFunction(a)?a(c,h)&&h.close():(k.replaceContent(c.getContent()),h.close()),b.finish()},error:function(a){h.error(a),console.error("Error while submitting form :"+a),b.finish()}})})})},error:function(a){h.error(a),console.log("Error occured while editing content: "+a.getFirstError())}})}},l.prototype["delete"]=function(){if(this.hasAction("delete")){var a=this;b("ui.modal").confirm({confirm:function(){var b=a.data(k);b?d.post(b,{data:{id:a.getKey()}}).then(function(b){a.remove()})["catch"](function(a){console.error("Error removing content",a)}):console.error("Content delete was called, but no url could be determined for "+this.base)}})}},l.prototype.remove=function(){var a=this;this.$.animate({height:"toggle",opacity:"toggle"},"fast",function(){a.$.remove()})},a["export"]({Content:l})}),humhub.initModule("stream",function(a,b,c){var d=b("util"),e=d.object,f=d.string,g=b("client"),h=b("content").Content,i=8,j=4,k="[data-stream]",l="[data-stream-entry]",m="stream-contentid",n=function(a){h.call(this,a)};e.inherits(n,h),n.prototype.actions=function(){return["delete","edit"]},n.prototype["delete"]=function(){var a=this.getContentComponent();a&&a["delete"]?a["delete"]():n._super["delete"].call(this)},n.prototype.getContentComponent=function(){var a=this.children();return a.length?a[0]:void 0},n.prototype.reload=function(){p().reload(this)},n.prototype.edit=function(){};var o=function(a){h.call(this,a),this.$.data(m)&&(this.contentId=parseInt(this.$.data(m))),this.$stream=this.$.find(".s2_stream"),this.url=this.$.data("stream"),this.$loader=this.$stream.find(".streamLoader"),this.$content=this.$stream.find(".s2_streamContent"),this.$filter=c(".wallFilterPanel"),this.filters=[],this.sort="c"};e.inherits(o,h),o.prototype.getContentActions=function(){return[]},o.prototype.init=function(){return this.clear(),this.$stream.show(),this.isShowSingleEntry()?this.loadSingleEntry(this.contentId):this.loadEntries(i),this},o.prototype.clear=function(){this.lastEntryLoaded=!1,this.readOnly=!1,this.loading=!1,this.$.find(".s2_streamContent").empty(),this.$.find(".s2_stream").hide(),this.$.find(".s2_single").hide(),this.$.find(".streamLoader").hide(),this.$.find(".emptyStreamMessage").hide(),this.$.find(".emptyFilterStreamMessage").hide(),this.$.find(".back_button_holder").hide(),this.$filter.hide()},o.prototype.loadSingleEntry=function(a){this.$.find(".back_button_holder").show(),this.loadEntries(1,a+1,"")},o.prototype.reloadEntry=function(a){var b=this;return new Promise(function(c,d){if(a=a instanceof n?a:b.getEntry(a),!a)return console.warn("Attempt to reload of non existent entry: "+a),void d();var e=a.getKey();return b._load(1,e+1,"").then(function(b){b.content[e]?(a.replaceContent(b.content[e].output),c(a)):(console.warn("Reload failed: ContentId not found in response: "+e),d())},d)})},o.prototype.loadEntries=function(a,b,d,f){if(!this.loading&&!this.lastEntryLoaded){this.$loader.show(),this.loading=!0,a=a||j,b=b||this.getLastContentId(),d=d||this.getFilterString(),f=f||this.sort;var g=this;return new Promise(function(h,i){g._load(a,b,d,f).then(function(a){g.$loader.hide(),e.isEmpty(a.content)?(g.lastEntryLoaded=!0,c("#btn-load-more").hide()):(g.lastEntryLoaded=a.is_last,g.appendEntries(a)),g.loading=!1,g.onChange(),h()})["catch"](function(a){g.loading=!1,g.$loader.hide(),i()})})}},o.prototype._load=function(a,b,c,d){return g.ajax(this.url,{data:{filters:c,sort:d,from:b,limit:a}})},o.prototype.getLastContentId=function(){var a=this.$stream.find(l).last();return a.length?a.data(m):void 0},o.prototype.appendEntries=function(a){var b=this,d="";return c.each(a.contentIds,function(c,e){var f=b.getEntry(e);f.length&&f.remove(),d+=a.content[e].output}),this.$content.append(d)},o.prototype.onChange=function(){this.readOnly?(c(".wallReadOnlyHide").hide(),c(".wallReadOnlyShow").show()):c(".wallReadOnlyShow").hide();var a=this.hasEntries();a||this.hasFilter()?a?this.isShowSingleEntry()||(this.$filter.show(),this.$.find(".emptyStreamMessage").hide(),this.$.find(".emptyFilterStreamMessage").hide()):this.$.find(".emptyFilterStreamMessage").hide():(this.$.find(".emptyStreamMessage").show(),this.$filter.hide()),this.$entryCache=this.getEntryNodes()},o.prototype.isShowSingleEntry=function(){return e.isDefined(this.contentId)},o.prototype.hasEntries=function(){return this.getEntryCount()>0},o.prototype.getEntryCount=function(){return this.$.find(l).length},o.prototype.getEntryNodes=function(){return this.$.find(l)},o.prototype.hasFilter=function(){return this.filters.length>0},o.prototype.getFilterString=function(){var a="";return c.each(this.filters,function(b,c){a+=c+","}),f.cutsuffix(a,",")},o.prototype.setFilter=function(a){this.filters.indexOf(a)<0&&this.filters.push(a)},o.prototype.unsetFilter=function(a){var b=this.filters.indexOf(a);b>-1&&this.filters.splice(b,1)},o.prototype.getEntry=function(a){return new n(this.$.find(l+'[data-content-key="'+a+'"]'))},o.prototype.getEntryByNode=function(a){return new n(a.closest(l))};var p=function(){if(!a.instance){var b=c(k).first();a.instance=b.length?new o(b):void 0}return a.instance},q=function(b){return a.getStream().getEntry(b)},r=function(){var a=p();if(!a)return void console.log("Non-Stream Page!");a.init();var b;c(window).scroll(function(){var d=c(window),e=d.scrollTop(),f=d.height();e===c(document).height()-d.height()&&(!a||a.loading||a.isShowSingleEntry()||a.lastEntryLoaded||a.loadEntries());var g=e+f/2,h=a.$entryCache.map(function(){var a=c(this);return a.offset().top<g?a:void 0}),i=h[h.length-1],j=i&&i.length?i.data("content-key"):"";b!==j&&(b=j,console.log(j))}),a.$.on("click",".singleBackLink",function(){a.contentId=void 0,a.init(),c(this).hide()}),s()},s=function(){c(".wallFilter").click(function(){var a=c(this),b=a.children("i");b.toggleClass("fa-square-o").toggleClass("fa-check-square-o"),b.hasClass("fa-check-square-o")?p().setFilter(a.attr("id").replace("filter_","")):p().unsetFilter(a.attr("id").replace("filter_","")),p().init()}),c(".wallSorting").click(function(){var a=c(this).attr("id");c(".wallSorting").find("i").removeClass("fa-check-square-o").addClass("fa-square-o"),c("#"+a).children("i").removeClass("fa-square-o").addClass("fa-check-square-o"),a=a.replace("sorting_",""),p().sort=a,p().init()})};a["export"]({StreamEntry:n,Stream:o,getStream:p,getEntry:q,init:r})});